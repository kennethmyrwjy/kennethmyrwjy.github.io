<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TikTok Login Demo (Insecure)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="tiktok-developers-site-verification" content="yvUDG2N57B02CRoR4MElDzwgXjPOJQc9">
    <style>
        body { font-family: Arial; background: #f5f8fc; }
        .container { max-width: 400px; margin: 80px auto; background: #fff; padding: 32px 22px; border-radius: 10px; box-shadow: 0 2px 18px #eaeaea; }
        h2 { font-weight: 600; }
        button { padding: 12px 32px; background: #16181a; color: #fff; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; }
        button:hover { background: #222326; }
        .profile { margin-top: 28px; }
        #result { margin-top: 18px; color: #1a8991; }
        .scopes { margin-bottom: 20px; }
        .scopes label { display: block; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Login with TikTok (DEMO)</h2>
        <form onsubmit="loginTikTok(); return false;">
            <div class="scopes">
                <p style="margin-top: 0; color: #555; font-size: 14px;">Select the data you want to access:</p>
                <label><input type="checkbox" class="scope" value="user.info.basic" checked> user.info.basic <span style="color: #888; font-size: 12px;">(name, avatar, open_id)</span> <strong style="color: #27ae60;">‚úì Works in Sandbox</strong></label>
                <label><input type="checkbox" class="scope" value="user.info.profile"> user.info.profile <span style="color: #888; font-size: 12px;">(bio, region, gender)</span> <span style="color: #e67e22;">‚ö†Ô∏è Limited in Sandbox</span></label>
                <label><input type="checkbox" class="scope" value="user.info.stats"> user.info.stats <span style="color: #888; font-size: 12px;">(followers, likes, video count)</span> <span style="color: #e67e22;">‚ö†Ô∏è Limited in Sandbox</span></label>
                <label><input type="checkbox" class="scope" value="video.list"> video.list <span style="color: #888; font-size: 12px;">(user's videos)</span> <span style="color: #e74c3c;">‚úó Not available in Sandbox</span></label>
                <p style="margin-bottom: 0; color: #3498db; font-size: 13px;">üí° For sandbox testing, use only <strong>user.info.basic</strong></p>
            </div>
            <button type="submit">Continue with TikTok</button>
        </form>
        <div id="result"></div>
        <div id="profile" class="profile"></div>
    </div>
<script src="config.js"></script>
<script>
    // TikTok app settings loaded from config.js
    const CLIENT_KEY = CONFIG.CLIENT_KEY;
    const REDIRECT_URI = CONFIG.REDIRECT_URI;
    const AUTHORIZE_URL = CONFIG.AUTHORIZE_URL;
    
    // CLIENT_SECRET is NOT needed in frontend - it's only used in the backend proxy server!

    function createState() {
        return Math.random().toString(36).substring(2, 15);
    }

    function loginTikTok() {
        const checkedScopes = Array.from(document.querySelectorAll('.scope:checked'))
            .map(cb => cb.value);
        if (checkedScopes.length === 0) {
            document.getElementById("result").innerText = "Select at least one scope.";
            return;
        }
        const SCOPES = checkedScopes.join(' ');
        console.log(SCOPES)
        const state = createState();
        localStorage.setItem("tiktokState", state);
        const url = `${AUTHORIZE_URL}?client_key=${encodeURIComponent(CLIENT_KEY)}&scope=${encodeURIComponent(SCOPES)}&response_type=code&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&state=${encodeURIComponent(state)}`;
        window.location.href = url;
    }

    // (existing callback/exchange logic would be on callback.html)

</script>
</body>
</html>
